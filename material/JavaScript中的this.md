当JavaScript代码执行一段可执行代码时，会创建对应的执行上下文。

对于每个执行上下文，都会有三个重要属性：

- 变量对象
- 作用域链
- `this`

执行上下文生命周期：

![执行上下文生命周期](https://raw.githubusercontent.com/chnjames/cloudImg/main/20210310152206.webp)

在JavaScript中，***`this`的指向是调用时决定的***，而不是创建时决定的，简单来说，`this`具有运行期绑定的特性。

##### 全局上下文

在全局执行上下文中`this`都指向全局对象

- this等价于window对象
- `var === this. === window.`
- 在浏览器中 `this`等价于`window`对象

##### 函数上下文

在函数内部，`this`的值取决于函数被调用的方式

- 直接调用：`this`指向全局变量
- call()、apply()：`this`指向绑定的对象
- bind()：`this`将永久绑定到`bind`的第一个参数
- 箭头函数：所有的箭头函数都没有自己的`this`，都指向外层
- 作为对象的一个方法：`this`指向调用函数的对象
- 作为一个构造函数：`this`被绑定到正在构造的新对象
- 作为一个DOM时间处理函数：`this`指向触发事件的元素，也就是始事件处理程序所绑定到的DOM节点
- HTML标签内联事件处理函数：`this`指向所在的DOM元素

##### 总结

**在一个函数上下文中，`this`由调用者提供，由调用函数的方式来决定。如果调用者函数，被某一个对象所拥有，那么该函数在调用时，内部的`this`指向该对象。如果函数独立调用，那么该函数内部的`this`，则指向`undefined`。但在非严格模式中，当`this`指向`undefined`时，它会被自动指向全局对象。**

- 若要判断一个函数的`this`绑定，就需要找到这个函数的直接调用位置，然后可以顺序按照下面四条规则来判断`this`的绑定对象：
  1. 由`new`调用：绑定到新创建的对象
  2. 由`call`或`apply`、`bind`调用：绑定到指定的对象
  3. 由上下文对象调用：绑定到上下文对象
  4. 默认：全局对象

> 箭头函数不使用上面的绑定规则，根据外层作用域来决定`this`，继承外层函数调用的`this`绑定



